---
title: "Exploratory Analysis"
author: "B. D. Schedin"
date: "10/1/2021"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

projRoot <- "C:/_git_/student-performance-analysis/"

library(tidyverse)
library(ggcorrplot)

```

# Data Preprocessing
```{r}

# Loading and combining raw data
d1 <- read.table(paste0(projRoot, "data/raw/student-mat.csv"), sep=";", header=TRUE)
d2 <- read.table(paste0(projRoot, "data/raw/student-por.csv"), sep=";", header=TRUE)

full <- bind_rows(d1, d2)

# Checking for duplicate rows
sum(duplicated(full) == FALSE)

# Checking for missing values by column
sapply(full, function(x) sum(is.na(x)))

# Exporting merged data to .csv
write.csv(full, paste0(projRoot, "data/processed/full.csv"), row.names=FALSE)

```

# Grade Distributions
```{r}

# Box plots period grades
full %>% 
  select(school, G1, G2, G3) %>% 
  reshape2::melt(id="school") %>% 
    ggplot(aes(x=variable, y=value)) + 
    geom_boxplot(aes(fill=school)) +
    theme_bw() +
    labs(title="Period Grades", x="Period", y="Score")

# Density plots for student grades
full %>% 
  select(school, G1) %>% 
    ggplot(aes(x=G1, fill=school)) +
    geom_density(alpha=0.25) +
    theme_bw() +
    labs(title="1st Period Grades", x="Score", y="Density")

full %>% 
  select(school, G2) %>% 
    ggplot(aes(x=G2, fill=school)) +
    geom_density(alpha=0.25) +
    theme_bw() +
    labs(title="2nd Period Grades", x="Score", y="Density")

full %>% 
  select(school, G3) %>% 
    ggplot(aes(x=G3, fill=school)) +
    geom_density(alpha=0.25) +
    theme_bw() +
    labs(title="3rd Period Grades", x="Score", y="Density")

# Selecting students that scored below threshold during each period
threshold <- 2.5

g1BelowScore <- full %>%
  select(everything()) %>%
  filter(G1 <= threshold)
g1BelowScore

g2BelowScore <- full %>%
  select(everything()) %>%
  filter(G2 <= threshold)
g2BelowScore

g3BelowScore <- full %>%
  select(everything()) %>%
  filter(G3 <= threshold)
g3BelowScore

# TODO: in dashboard, provide check boxes to show/hide columns

```

# Performance Correlations
```{r}

# Filtering on numeric data
fullNum <- full %>%
  select(where(is.numeric))

# Computing correlations between variables
varCor <- cor(fullNum)

# Plotting correlation table
ggcorrplot(varCor) + 
  theme(axis.text.x = element_text(size=11, angle=90, hjust=0.99, vjust=0.3), axis.text.y=element_text(size=11)) + 
  labs(title = "Variable Correlations", x="Variable 1", y="Variable 2")

# TODO: are all numeric variables continuous, or are they really factors encoded as numbers?
# TODO: good way to do correlations between factors/non-numeric?

```














